<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>Unemployment rate by counties</title>
    <style type="text/css">
      body {
          text-shadow: -1px -1px 0 white, 1px -1px 0 white, -1px 1px 0 white, 1px 1px 0 white;
      }
      .link {
          stroke: #999;
          stroke-opacity: 1;
      }
      .states {
          fill: none;
          stroke: #fff;
          stroke-linejoin: round;
      }

    </style>
  </head>
<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script
  <script src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
  <script type="text/javascript">
    var width = 960, height = 500, marginX =50, marginY = 50;

    var color = d3.scale.threshold()
                    .domain([.02, .04, .06, .08, .10])
                    .range(["#f2f0f7", "#dadaeb", "#bcbddc", "#9e9ac8", "#756bb1", "#54278f"]);

    var path = d3.geo.path();

    var svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height);

    queue()
        .defer(d3.json, "/mbostock/raw/4090846/us.json")
        .defer(d3.tsv, "/data/unemployment.tsv")
        .await(ready);

    function ready(error, us, unemployment) {
        if (error) throw error;

        var rateById = {};

        unemployment.forEach(function(d) {rateById[d.id] = +d.rate;});

        svg.append("g")
                .attr("class", "counties")
            .selectAll("path")
                .data(topojson.feature(us, us.objects.counties).features)
            .enter().append("path")
                .attr("d", path)
                .style("fill", function(d){return color(rateById[d.id]);});

        svg.append("path")
            .datum(topojson.mesh(us, us.objects.states, function(a, b){return a.id != b.id;}))
            .attr("d", path);
    }
  </script>
</body>
</hml>
